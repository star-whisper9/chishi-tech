import{a as se,g as ne,r as h,u as ae,E as Ie,P as Ee,F as pe,k as Ae,b as oe,d as Y,s as P,j as o,f as G,e as ie,H as Me,J as We,m as ve,T as m,i as Te,c as Z,A as v,R as F,C as ue,v as we,S as W,t as I,I as he,w as U,y as le,D as _e,z as Ue,M as Pe}from"./index-B41KS2sj.js";import{S as fe}from"./Slider-C5Yy5uaL.js";import{A as X}from"./Alert-BPVTXbCU.js";import{L as me}from"./LinearProgress-DdU8gojQ.js";import{F as Ne,I as Be,S as $e}from"./Select-DJHKAdHA.js";import{C as Ve}from"./Chip-DSvwBCg2.js";function Ke(e){return ne("MuiDialog",e)}const de=se("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),be=h.createContext({}),ze=P(We,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),He=e=>{const{classes:t,scroll:r,maxWidth:s,fullWidth:n,fullScreen:a}=e,c={root:["root"],container:["container",`scroll${G(r)}`],paper:["paper",`paperScroll${G(r)}`,`paperWidth${G(String(s))}`,n&&"paperFullWidth",a&&"paperFullScreen"]};return ie(c,Ke,t)},Xe=P(Me,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),Ge=P("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.container,t[`scroll${G(r.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),Ye=P(Ee,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.paper,t[`scrollPaper${G(r.scroll)}`],t[`paperWidth${G(String(r.maxWidth))}`],r.fullWidth&&t.paperFullWidth,r.fullScreen&&t.paperFullScreen]}})(ve(({theme:e})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:t})=>!t.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:e.breakpoints.unit==="px"?Math.max(e.breakpoints.values.xs,444):`max(${e.breakpoints.values.xs}${e.breakpoints.unit}, 444px)`,[`&.${de.paperScrollBody}`]:{[e.breakpoints.down(Math.max(e.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(e.breakpoints.values).filter(t=>t!=="xs").map(t=>({props:{maxWidth:t},style:{maxWidth:`${e.breakpoints.values[t]}${e.breakpoints.unit}`,[`&.${de.paperScrollBody}`]:{[e.breakpoints.down(e.breakpoints.values[t]+64)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:t})=>t.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:t})=>t.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${de.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),Ze=h.forwardRef(function(t,r){const s=ae({props:t,name:"MuiDialog"}),n=Ie(),a={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{"aria-describedby":c,"aria-labelledby":i,"aria-modal":u=!0,BackdropComponent:g,BackdropProps:f,children:b,className:R,disableEscapeKeyDown:N=!1,fullScreen:j=!1,fullWidth:B=!1,maxWidth:w="sm",onClick:$,onClose:A,open:V,PaperComponent:T=Ee,PaperProps:z={},scroll:q="paper",slots:_={},slotProps:p={},TransitionComponent:E=pe,transitionDuration:O=a,TransitionProps:k,...x}=s,l={...s,disableEscapeKeyDown:N,fullScreen:j,fullWidth:B,maxWidth:w,scroll:q},S=He(l),L=h.useRef(),J=te=>{L.current=te.target===te.currentTarget},C=te=>{$&&$(te),L.current&&(L.current=null,A&&A(te,"backdropClick"))},D=Ae(i),Q=h.useMemo(()=>({titleId:D}),[D]),M={transition:E,..._},y={transition:k,paper:z,backdrop:f,...p},K={slots:M,slotProps:y},[ee,De]=oe("root",{elementType:Xe,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:l,className:Y(S.root,R),ref:r}),[Se,Ce]=oe("backdrop",{elementType:ze,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:l}),[je,Oe]=oe("paper",{elementType:Ye,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:l,className:Y(S.paper,z.className)}),[ye,Fe]=oe("container",{elementType:Ge,externalForwardedProps:K,ownerState:l,className:S.container}),[ke,Le]=oe("transition",{elementType:pe,externalForwardedProps:K,ownerState:l,additionalProps:{appear:!0,in:V,timeout:O,role:"presentation"}});return o.jsx(ee,{closeAfterTransition:!0,slots:{backdrop:Se},slotProps:{backdrop:{transitionDuration:O,as:g,...Ce}},disableEscapeKeyDown:N,onClose:A,open:V,onClick:C,...De,...x,children:o.jsx(ke,{...Le,children:o.jsx(ye,{onMouseDown:J,...Fe,children:o.jsx(je,{as:T,elevation:24,role:"dialog","aria-describedby":c,"aria-labelledby":D,"aria-modal":u,...Oe,children:o.jsx(be.Provider,{value:Q,children:b})})})})})});function qe(e){return ne("MuiDialogActions",e)}se("MuiDialogActions",["root","spacing"]);const Je=e=>{const{classes:t,disableSpacing:r}=e;return ie({root:["root",!r&&"spacing"]},qe,t)},Qe=P("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disableSpacing&&t.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),et=h.forwardRef(function(t,r){const s=ae({props:t,name:"MuiDialogActions"}),{className:n,disableSpacing:a=!1,...c}=s,i={...s,disableSpacing:a},u=Je(i);return o.jsx(Qe,{className:Y(u.root,n),ownerState:i,ref:r,...c})});function tt(e){return ne("MuiDialogContent",e)}se("MuiDialogContent",["root","dividers"]);function ot(e){return ne("MuiDialogTitle",e)}const rt=se("MuiDialogTitle",["root"]),st=e=>{const{classes:t,dividers:r}=e;return ie({root:["root",r&&"dividers"]},tt,t)},nt=P("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.dividers&&t.dividers]}})(ve(({theme:e})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:t})=>t.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(e.vars||e).palette.divider}`,borderBottom:`1px solid ${(e.vars||e).palette.divider}`}},{props:({ownerState:t})=>!t.dividers,style:{[`.${rt.root} + &`]:{paddingTop:0}}}]}))),at=h.forwardRef(function(t,r){const s=ae({props:t,name:"MuiDialogContent"}),{className:n,dividers:a=!1,...c}=s,i={...s,dividers:a},u=st(i);return o.jsx(nt,{className:Y(u.root,n),ownerState:i,ref:r,...c})});function it(e){return ne("MuiDialogContentText",e)}se("MuiDialogContentText",["root"]);const lt=e=>{const{classes:t}=e,s=ie({root:["root"]},it,t);return{...t,...s}},ct=P(m,{shouldForwardProp:e=>Te(e)||e==="classes",name:"MuiDialogContentText",slot:"Root"})({}),dt=h.forwardRef(function(t,r){const s=ae({props:t,name:"MuiDialogContentText"}),{children:n,className:a,...c}=s,i=lt(c);return o.jsx(ct,{component:"p",variant:"body1",color:"textSecondary",ref:r,ownerState:c,className:Y(i.root,a),...s,classes:i})}),ut=e=>{const{classes:t}=e;return ie({root:["root"]},ot,t)},pt=P(m,{name:"MuiDialogTitle",slot:"Root"})({padding:"16px 24px",flex:"0 0 auto"}),ht=h.forwardRef(function(t,r){const s=ae({props:t,name:"MuiDialogTitle"}),{className:n,id:a,...c}=s,i=s,u=ut(i),{titleId:g=a}=h.useContext(be);return o.jsx(pt,{component:"h2",className:Y(u.root,n),ownerState:i,ref:r,variant:"h6",id:a??g,...c})}),xe=Z(o.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),ft=Z(o.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l4.65-4.65c.2-.2.51-.2.71 0L17 13z"})),mt=Z(o.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"})),xt=Z(o.jsx("path",{d:"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1"})),gt=Z(o.jsx("path",{d:"m10.8 15.9 4.67-3.5c.27-.2.27-.6 0-.8L10.8 8.1c-.33-.25-.8-.01-.8.4v7c0 .41.47.65.8.4M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),ge=Z(o.jsx("path",{d:"M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3M12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1m1 4h-2v-2h2z"}));var d;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(d||(d={}));const Rt=(()=>{let e=0;return()=>e++})(),Et=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),vt=new Error("called FFmpeg.terminate()");class wt{#t=null;#r={};#o={};#s=[];#n=[];loaded=!1;#a=()=>{this.#t&&(this.#t.onmessage=({data:{id:t,type:r,data:s}})=>{switch(r){case d.LOAD:this.loaded=!0,this.#r[t](s);break;case d.MOUNT:case d.UNMOUNT:case d.EXEC:case d.FFPROBE:case d.WRITE_FILE:case d.READ_FILE:case d.DELETE_FILE:case d.RENAME:case d.CREATE_DIR:case d.LIST_DIR:case d.DELETE_DIR:this.#r[t](s);break;case d.LOG:this.#s.forEach(n=>n(s));break;case d.PROGRESS:this.#n.forEach(n=>n(s));break;case d.ERROR:this.#o[t](s);break}delete this.#r[t],delete this.#o[t]})};#e=({type:t,data:r},s=[],n)=>this.#t?new Promise((a,c)=>{const i=Rt();this.#t&&this.#t.postMessage({id:i,type:t,data:r},s),this.#r[i]=a,this.#o[i]=c,n?.addEventListener("abort",()=>{c(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Et);on(t,r){t==="log"?this.#s.push(r):t==="progress"&&this.#n.push(r)}off(t,r){t==="log"?this.#s=this.#s.filter(s=>s!==r):t==="progress"&&(this.#n=this.#n.filter(s=>s!==r))}load=({classWorkerURL:t,...r}={},{signal:s}={})=>(this.#t||(this.#t=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#a()),this.#e({type:d.LOAD,data:r},void 0,s));exec=(t,r=-1,{signal:s}={})=>this.#e({type:d.EXEC,data:{args:t,timeout:r}},void 0,s);ffprobe=(t,r=-1,{signal:s}={})=>this.#e({type:d.FFPROBE,data:{args:t,timeout:r}},void 0,s);terminate=()=>{const t=Object.keys(this.#o);for(const r of t)this.#o[r](vt),delete this.#o[r],delete this.#r[r];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(t,r,{signal:s}={})=>{const n=[];return r instanceof Uint8Array&&n.push(r.buffer),this.#e({type:d.WRITE_FILE,data:{path:t,data:r}},n,s)};mount=(t,r,s)=>{const n=[];return this.#e({type:d.MOUNT,data:{fsType:t,options:r,mountPoint:s}},n)};unmount=t=>{const r=[];return this.#e({type:d.UNMOUNT,data:{mountPoint:t}},r)};readFile=(t,r="binary",{signal:s}={})=>this.#e({type:d.READ_FILE,data:{path:t,encoding:r}},void 0,s);deleteFile=(t,{signal:r}={})=>this.#e({type:d.DELETE_FILE,data:{path:t}},void 0,r);rename=(t,r,{signal:s}={})=>this.#e({type:d.RENAME,data:{oldPath:t,newPath:r}},void 0,s);createDir=(t,{signal:r}={})=>this.#e({type:d.CREATE_DIR,data:{path:t}},void 0,r);listDir=(t,{signal:r}={})=>this.#e({type:d.LIST_DIR,data:{path:t}},void 0,r);deleteDir=(t,{signal:r}={})=>this.#e({type:d.DELETE_DIR,data:{path:t}},void 0,r)}var ce;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(ce||(ce={}));const bt=new Error("failed to get response body reader"),Dt=new Error("failed to complete download"),St="Content-Length",Ct=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{const{result:n}=s;n instanceof ArrayBuffer?t(new Uint8Array(n)):t(new Uint8Array)},s.onerror=n=>{r(Error(`File could not be read! Code=${n?.target?.error?.code||-1}`))},s.readAsArrayBuffer(e)}),jt=async e=>{let t;if(typeof e=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else if(e instanceof File||e instanceof Blob)t=await Ct(e);else return new Uint8Array;return new Uint8Array(t)},Ot=async(e,t)=>{const r=await fetch(e);let s;try{const n=parseInt(r.headers.get(St)||"-1"),a=r.body?.getReader();if(!a)throw bt;const c=[];let i=0;for(;;){const{done:f,value:b}=await a.read(),R=b?b.length:0;if(f){if(n!=-1&&n!==i)throw Dt;t&&t({url:e,total:n,received:i,delta:R,done:f});break}c.push(b),i+=R,t&&t({url:e,total:n,received:i,delta:R,done:f})}const u=new Uint8Array(i);let g=0;for(const f of c)u.set(f,g),g+=f.length;s=u.buffer}catch(n){console.log("failed to send download progress event: ",n),s=await r.arrayBuffer()}return s},re=async(e,t,r=!1,s)=>{const n=r?await Ot(e,s):await(await fetch(e)).arrayBuffer(),a=new Blob([n],{type:t});return URL.createObjectURL(a)};function yt(){try{return typeof File>"u"?(console.warn("[WORKERFS] File API 不支持"),!1):typeof Worker>"u"?(console.warn("[WORKERFS] Web Worker 不支持"),!1):typeof window<"u"&&!window.isSecureContext?(console.warn("[WORKERFS] 非安全上下文（需要 HTTPS 或 localhost）"),!1):(console.log("[WORKERFS] 静态环境检查通过"),!0)}catch(e){return console.error("[WORKERFS] 静态检查失败:",e),!1}}async function Ft(e){const t="/.probe-workerfs";try{await e.createDir(t);const r=new Uint8Array([1,2,3]),s=new Blob([r],{type:"application/octet-stream"}),n=new File([s],"probe.bin",{type:"application/octet-stream"});await e.mount(ce.WORKERFS,{files:[n]},t);const a=await e.readFile(`${t}/probe.bin`),c=a&&a.length===r.length;return await e.unmount(t),await e.deleteDir(t),console.log(`[WORKERFS] 动态探测${c?"成功":"失败"}`),c}catch(r){console.warn("[WORKERFS] 动态探测失败:",r);try{await e.unmount(t).catch(()=>{}),await e.deleteDir(t).catch(()=>{})}catch{}return!1}}async function kt(e){try{return yt()?await Ft(e):!1}catch(t){return console.error("[WORKERFS] 支持检测失败:",t),!1}}function Lt(e){const t=e.match(/\.[^/.]+$/);return t?t[0]:""}function It(e){return{mp4:"video/mp4",mov:"video/quicktime",mkv:"video/x-matroska",gif:"image/gif"}[e]||"video/mp4"}function H(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}const At=()=>{const[e,t]=h.useState(!1),[r,s]=h.useState(!1),[n,a]=h.useState(null),[c,i]=h.useState(null),[u,g]=h.useState(null),[f,b]=h.useState(null),[R,N]=h.useState(!1),j=h.useRef(null),B=h.useRef(!1),w=h.useRef(null),$=h.useCallback(async()=>{if(!(B.current&&j.current)){t(!0),i(null);try{const p=new wt;p.on("log",({message:x})=>{console.log("[FFmpeg]",x)}),p.on("progress",({progress:x,time:l})=>{a({ratio:x,time:l,speed:`${(x*100).toFixed(1)}%`})});let E=!1,O=null;try{console.log("[FFmpeg] 正在加载多线程版本...");const x=v.CDN_PACKAGES.FFMPEG_MT;await p.load({coreURL:await re(`${x}/ffmpeg-core.js`,"text/javascript"),wasmURL:await re(`${x}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await re(`${x}/ffmpeg-core.worker.js`,"text/javascript")}),E=!0,console.log("[FFmpeg] ✅ 多线程版本加载成功")}catch(x){console.warn("[FFmpeg] ⚠️ 多线程版本加载失败，尝试单线程版本...",x),O=x instanceof Error?x:new Error(String(x));try{const l=v.CDN_PACKAGES.FFMPEG;await p.load({coreURL:await re(`${l}/ffmpeg-core.js`,"text/javascript"),wasmURL:await re(`${l}/ffmpeg-core.wasm`,"application/wasm")}),E=!0,console.log("[FFmpeg] ✅ 单线程版本加载成功")}catch(l){console.error("[FFmpeg] ❌ 单线程版本也加载失败",l),O=l instanceof Error?l:new Error(String(l))}}if(!E)throw O||new Error("所有 FFmpeg 版本均加载失败");j.current=p,B.current=!0,console.log("[WORKERFS] 开始检测支持...");const k=await kt(p);N(k),console.log(k?"[WORKERFS] ✅ 支持！将在处理时优先使用 WORKERFS 模式":"[WORKERFS] ❌ 不支持，将使用 RAM 模式")}catch(p){const E=p instanceof Error?p.message:"加载 FFmpeg 失败";i(E),console.error("加载 FFmpeg 失败:",p)}finally{t(!1)}}},[]),A=h.useCallback(()=>{u?.url&&URL.revokeObjectURL(u.url),g(null)},[u]),V=h.useCallback(async(p,E,O)=>{if(!j.current||!B.current){i("FFmpeg 尚未加载，请先加载");return}const k=new AbortController;w.current=k,s(!0),i(null),a(null),u?.url&&URL.revokeObjectURL(u.url),g(null);const x=R;try{const l=j.current,S="input"+Lt(p.name),L=`output.${E}`;if(x){console.log("[WORKERFS] 使用 WORKERFS 模式处理大文件...");const y="/input",K=`${y}/${p.name}`;try{await l.createDir(y),await l.mount(ce.WORKERFS,{files:[p]},y),console.log("开始转换...");const ee=Re(K,L,E,O);await l.exec(ee,void 0,{signal:k.signal}),await l.unmount(y),await l.deleteDir(y)}catch(ee){try{await l.unmount(y).catch(()=>{}),await l.deleteDir(y).catch(()=>{})}catch{}throw ee}}else{console.log("[RAM] 使用传统 RAM 模式..."),console.log("写入输入文件..."),await l.writeFile(S,await jt(p)),console.log("开始转换...");const y=Re(S,L,E,O);await l.exec(y,void 0,{signal:k.signal}),await l.deleteFile(S)}console.log("读取输出文件...");const J=await l.readFile(L),C=new Blob([J],{type:It(E)}),D=URL.createObjectURL(C),M=`${p.name.replace(/\.[^/.]+$/,"")}.${E}`;g({url:D,name:M}),console.log(`转换成功 (使用 ${x?"WORKERFS":"RAM"} 模式)`),await l.deleteFile(L)}catch(l){if(l instanceof DOMException&&l.name==="AbortError")console.log("转换已被用户取消"),i("转换已取消");else{const S=l instanceof Error?l.message:"视频转换失败";i(S),console.error("视频转换失败:",l)}}finally{s(!1),a(null),w.current=null}},[u,R]),T=h.useCallback(()=>{w.current&&r&&(console.log("正在取消转换..."),w.current.abort())},[r]),z=h.useCallback(p=>{const E=URL.createObjectURL(p);return b(E),E},[]),q=h.useCallback(p=>{URL.revokeObjectURL(p),f===p&&b(null)},[f]),_=h.useCallback(()=>{i(null)},[]);return{isLoading:e,isConverting:r,progress:n,error:c,outputFile:u,previewUrl:f,supportsWorkerFS:R,loadFFmpeg:$,convertVideo:V,cancelConversion:T,clearOutput:A,clearError:_,getPreviewUrl:z,revokePreviewUrl:q}};function Re(e,t,r,s){const n=["-i",e];let a=[];switch(r){case"mp4":case"mov":a=["-c:v","libx264","-preset","medium","-crf","23","-c:a","aac"];break;case"mkv":a=["-c:v","libx265","-preset","medium","-crf","24","-c:a","aac"];break;case"gif":{const c=s?.fps||v.VIDEO_CONVERTOR.DEFAULT_WIDTH/48,i=s?.width||v.VIDEO_CONVERTOR.DEFAULT_WIDTH;let u=`fps=${Math.min(c,v.VIDEO_CONVERTOR.MAX_FPS)}`;if(u+=`,scale=${Math.min(i,v.VIDEO_CONVERTOR.MAX_WIDTH)}:-1:flags=lanczos`,s?.maxDuration){const f=v.VIDEO_CONVERTOR.MAX_FRAMES/c;a=["-t",Math.min(s.maxDuration,f).toString()]}a=[...a,"-vf",u];break}default:a=["-c:v","copy","-c:a","copy"]}return[...n,...a,t]}const Mt=({config:e,onChange:t,videoDuration:r})=>{const s=(g,f)=>{t({...e,fps:f})},n=(g,f)=>{t({...e,width:f})},a=r?Math.ceil(e.fps*r):null,c=v.VIDEO_CONVERTOR.MAX_FRAMES/e.fps,i=a!==null&&a>v.VIDEO_CONVERTOR.MAX_FRAMES,u=i?c:r;return F.useEffect(()=>{if(i&&u)t({...e,maxDuration:u});else{const{maxDuration:g,...f}=e;g!==void 0&&t(f)}},[i,u]),o.jsx(ue,{variant:"outlined",sx:{mt:2},children:o.jsxs(we,{children:[o.jsx(m,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"GIF 转换设置"}),o.jsxs(W,{spacing:3,children:[o.jsxs(I,{children:[o.jsxs(m,{variant:"body2",gutterBottom:!0,children:["帧率 (FPS): ",e.fps]}),o.jsx(fe,{value:e.fps,onChange:s,min:1,max:v.VIDEO_CONVERTOR.MAX_FPS,step:1,marks:[{value:3,label:"3"},{value:10,label:"10"},{value:15,label:"15"},{value:24,label:"24"},{value:30,label:"30"}],valueLabelDisplay:"auto"}),o.jsx(m,{variant:"caption",color:"text.secondary",children:"较低的帧率可以减小文件大小，但动画会不够流畅"})]}),o.jsxs(I,{children:[o.jsxs(m,{variant:"body2",gutterBottom:!0,children:["宽度 (px): ",e.width]}),o.jsx(fe,{value:e.width,onChange:n,min:240,max:v.VIDEO_CONVERTOR.MAX_WIDTH,step:40,marks:[{value:360,label:"360"},{value:480,label:"480"},{value:720,label:"720"},{value:1080,label:"1080"},{value:1920,label:"1920"}],valueLabelDisplay:"auto"}),o.jsx(m,{variant:"caption",color:"text.secondary",children:"宽度越小，文件大小越小。高度会按比例自动调整"})]}),a!==null&&o.jsxs(X,{severity:i?"warning":"info",sx:{mt:1},children:[o.jsxs(m,{variant:"body2",children:["预估帧数: ",a.toLocaleString()," 帧"]}),i&&o.jsxs(o.Fragment,{children:[o.jsxs(m,{variant:"body2",sx:{mt:1},children:["⚠️ 超出最大帧数限制 (",v.VIDEO_CONVERTOR.MAX_FRAMES.toLocaleString()," 帧)"]}),o.jsxs(m,{variant:"body2",sx:{mt:.5},children:["将只转换前 ",c.toFixed(1)," 秒的内容"]})]})]})]})]})})},Wt=()=>{const{isLoading:e,isConverting:t,progress:r,error:s,outputFile:n,loadFFmpeg:a,convertVideo:c,cancelConversion:i,clearOutput:u,clearError:g,getPreviewUrl:f,revokePreviewUrl:b}=At(),[R,N]=F.useState(null),[j,B]=F.useState("mp4"),[w,$]=F.useState(null),[A,V]=F.useState(null),[T,z]=F.useState(v.VIDEO_CONVERTOR.MAX_FILE_SIZE_BYTES),[q,_]=F.useState(!1),[p,E]=F.useState({fps:10,width:v.VIDEO_CONVERTOR.DEFAULT_WIDTH}),O=F.useRef(null);F.useEffect(()=>{a()},[a]),F.useEffect(()=>()=>{w&&b(w)},[w,b]);const k=C=>{const D=C.target.files?.[0];if(D){if(!D.type.startsWith("video/")&&!D.name.endsWith(".mkv")){alert("请选择视频文件");return}if(D.size>T){alert(`文件大小超过限制 (${H(T)})。
当前文件大小: ${H(D.size)}

您可以在下方解除限制。`);return}N(D),g();const Q=f(D);$(Q);const M=document.createElement("video");M.preload="metadata",M.onloadedmetadata=()=>{V(M.duration),URL.revokeObjectURL(M.src)},M.src=Q}},x=async()=>{if(!R)return;await c(R,j,j==="gif"?p:void 0)},l=()=>{if(!n)return;const C=document.createElement("a");C.href=n.url,C.download=n.name,C.click()},S=()=>{N(null),w&&(b(w),$(null)),V(null),u(),g()},L=()=>{_(!0)},J=()=>{z(v.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED),_(!1)};return o.jsxs(I,{sx:{maxWidth:800,mx:"auto",py:3},children:[o.jsx(ue,{elevation:3,children:o.jsxs(we,{children:[o.jsx(X,{severity:"info",sx:{mb:2},children:o.jsxs(m,{variant:"body2",color:"text.secondary",children:["请避免使用 32 位浏览器，有可能加载失败甚至崩溃。",o.jsx("br",{}),"浏览器转码处理速度慢（尤其是H.265编码），请耐心等待，大文件建议使用原生应用。"]})}),e&&o.jsxs(X,{severity:"info",sx:{mb:2},children:[o.jsx(m,{variant:"body2",children:"正在加载 FFmpeg..."}),o.jsx(me,{sx:{mt:1}})]}),s&&o.jsx(X,{severity:"error",sx:{mb:2},action:o.jsx(he,{color:"inherit",size:"small",onClick:g,children:o.jsx(xe,{fontSize:"small"})}),children:s}),o.jsxs(W,{spacing:3,children:[T<v.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED&&o.jsxs(X,{severity:"info",sx:{mb:0},children:[o.jsxs(m,{variant:"body2",gutterBottom:!0,children:["当前文件大小限制: ",H(T)]}),o.jsxs(U,{size:"small",variant:"outlined",onClick:L,startIcon:o.jsx(ge,{}),sx:{mt:1},children:["解除限制（最大"," ",H(v.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED),"）"]})]}),o.jsxs(I,{children:[o.jsxs(U,{variant:"contained",component:"label",startIcon:o.jsx(ft,{}),disabled:e||t,fullWidth:!0,children:["选择视频文件",o.jsx("input",{type:"file",accept:"video/*",hidden:!0,onChange:k})]}),R&&o.jsx(ue,{variant:"outlined",sx:{mt:2,p:2},children:o.jsxs(W,{direction:"row",spacing:2,alignItems:"center",children:[o.jsxs(I,{flex:1,children:[o.jsx(m,{variant:"body2",fontWeight:"medium",children:R.name}),o.jsxs(m,{variant:"caption",color:"text.secondary",children:[H(R.size),A&&` • ${A.toFixed(1)}秒`]})]}),o.jsx(he,{size:"small",onClick:S,disabled:t,children:o.jsx(mt,{})})]})})]}),R&&w&&o.jsxs(I,{children:[o.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"视频预览"}),o.jsx(I,{sx:{position:"relative",width:"100%",maxWidth:640,mx:"auto",bgcolor:"black",borderRadius:1,overflow:"hidden"},children:o.jsx("video",{ref:O,src:w,controls:!0,style:{width:"100%",height:"auto",display:"block"}})})]}),R&&o.jsxs(o.Fragment,{children:[o.jsxs(Ne,{fullWidth:!0,children:[o.jsx(Be,{id:"output-format-label",children:"输出格式"}),o.jsxs($e,{labelId:"output-format-label",value:j,label:"输出格式",onChange:C=>B(C.target.value),disabled:t,children:[o.jsx(le,{value:"mp4",children:"MP4 (H.264)"}),o.jsx(le,{value:"mov",children:"MOV (H.264)"}),o.jsx(le,{value:"mkv",children:"MKV (H.265)"}),o.jsx(le,{value:"gif",children:"GIF (动图)"})]})]}),j==="gif"&&o.jsx(Mt,{config:p,onChange:E,videoDuration:A||void 0}),t?o.jsx(W,{direction:"row",spacing:2,children:o.jsx(U,{variant:"outlined",color:"error",size:"large",startIcon:o.jsx(xe,{}),onClick:i,fullWidth:!0,children:"取消转换"})}):o.jsx(U,{variant:"contained",color:"primary",size:"large",startIcon:o.jsx(gt,{}),onClick:x,disabled:!R||e||t,fullWidth:!0,children:"开始转换"})]}),t&&r&&o.jsxs(I,{children:[o.jsxs(W,{direction:"row",justifyContent:"space-between",mb:1,children:[o.jsx(m,{variant:"body2",children:"转换进度"}),o.jsx(m,{variant:"body2",fontWeight:"medium",children:r.speed})]}),o.jsx(me,{variant:"determinate",value:r.ratio*100})]}),n&&o.jsxs(o.Fragment,{children:[o.jsx(_e,{}),o.jsxs(X,{severity:"success",sx:{mb:0},children:[o.jsx(m,{variant:"body2",gutterBottom:!0,children:"转换完成！"}),o.jsx(W,{direction:"row",spacing:1,alignItems:"center",mt:1,children:o.jsx(Ve,{label:n.name,size:"small",color:"success"})})]}),o.jsxs(W,{direction:"row",spacing:2,children:[o.jsx(U,{variant:"contained",color:"success",startIcon:o.jsx(xt,{}),onClick:l,fullWidth:!0,children:"下载转换后的视频"}),o.jsx(U,{variant:"outlined",onClick:S,children:"重新转换"})]})]})]})]})}),o.jsxs(Ze,{open:q,onClose:()=>_(!1),children:[o.jsx(ht,{children:o.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[o.jsx(ge,{color:"warning"}),o.jsx("span",{children:"解除文件大小限制"})]})}),o.jsx(at,{children:o.jsxs(dt,{children:["您即将解除文件大小限制，最大可处理"," ",H(v.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED)," 的文件。",o.jsx("br",{}),o.jsx("br",{}),"• 处理大文件将会消耗大量内存和时间",o.jsx("br",{}),"• 可能导致浏览器卡顿或崩溃",o.jsx("br",{}),"• 请确认设备硬件配置较好",o.jsx("br",{}),o.jsx("br",{}),"确定要继续吗？"]})}),o.jsxs(et,{children:[o.jsx(U,{onClick:()=>_(!1),children:"取消"}),o.jsx(U,{onClick:J,color:"warning",variant:"contained",children:"确认解除限制"})]})]})]})},$t=()=>{let e="视频格式转换器",t="在浏览器中转换视频格式，支持多种格式互转。";for(const r of Ue)r.link==="/videoconvertor"&&(e=r.title,t=r.description);return o.jsx(Pe,{children:o.jsx(I,{sx:{py:6},children:o.jsxs(W,{spacing:4,alignItems:"center",children:[o.jsxs(I,{textAlign:"center",children:[o.jsx(m,{variant:"h3",gutterBottom:!0,children:e}),o.jsx(m,{variant:"h6",color:"text.secondary",children:t})]}),o.jsx(Wt,{})]})})})};export{$t as default};
