import{a as re,g as se,r as p,u as ne,L as Ie,P as Ee,O as pe,k as Ae,b as te,d as G,s as P,j as o,f as H,e as ae,Q as Me,U as We,m as ve,T as x,i as Te,c as Y,A as E,R as y,C as ue,v as be,S as M,t as L,w as U,y as ie,D as _e,z as Ue,M as Pe}from"./index-yhJVPjB6.js";import{S as he,A as oe,I as fe}from"./Slider-XOybTai5.js";import{L as me,C as Ne}from"./LinearProgress-Cmy73fXo.js";import{F as Be,I as $e,S as Ve}from"./Select-C8kzNvNh.js";function Ke(e){return se("MuiDialog",e)}const ce=re("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),we=p.createContext({}),ze=P(We,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),Xe=e=>{const{classes:t,scroll:r,maxWidth:s,fullWidth:n,fullScreen:a}=e,l={root:["root"],container:["container",`scroll${H(r)}`],paper:["paper",`paperScroll${H(r)}`,`paperWidth${H(String(s))}`,n&&"paperFullWidth",a&&"paperFullScreen"]};return ae(l,Ke,t)},He=P(Me,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),Ge=P("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.container,t[`scroll${H(r.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),Ye=P(Ee,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.paper,t[`scrollPaper${H(r.scroll)}`],t[`paperWidth${H(String(r.maxWidth))}`],r.fullWidth&&t.paperFullWidth,r.fullScreen&&t.paperFullScreen]}})(ve(({theme:e})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:t})=>!t.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:e.breakpoints.unit==="px"?Math.max(e.breakpoints.values.xs,444):`max(${e.breakpoints.values.xs}${e.breakpoints.unit}, 444px)`,[`&.${ce.paperScrollBody}`]:{[e.breakpoints.down(Math.max(e.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(e.breakpoints.values).filter(t=>t!=="xs").map(t=>({props:{maxWidth:t},style:{maxWidth:`${e.breakpoints.values[t]}${e.breakpoints.unit}`,[`&.${ce.paperScrollBody}`]:{[e.breakpoints.down(e.breakpoints.values[t]+64)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:t})=>t.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:t})=>t.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${ce.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),Ze=p.forwardRef(function(t,r){const s=ne({props:t,name:"MuiDialog"}),n=Ie(),a={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{"aria-describedby":l,"aria-labelledby":i,"aria-modal":d=!0,BackdropComponent:g,BackdropProps:f,children:b,className:R,disableEscapeKeyDown:N=!1,fullScreen:O=!1,fullWidth:B=!1,maxWidth:v="sm",onClick:$,onClose:I,open:V,PaperComponent:W=Ee,PaperProps:z={},scroll:Z="paper",slots:T={},slotProps:h={},TransitionComponent:m=pe,transitionDuration:F=a,TransitionProps:D,..._}=s,u={...s,disableEscapeKeyDown:N,fullScreen:O,fullWidth:B,maxWidth:v,scroll:Z},S=Xe(u),k=p.useRef(),q=ee=>{k.current=ee.target===ee.currentTarget},C=ee=>{$&&$(ee),k.current&&(k.current=null,I&&I(ee,"backdropClick"))},w=Ae(i),Q=p.useMemo(()=>({titleId:w}),[w]),A={transition:m,...T},j={transition:D,paper:z,backdrop:f,...h},K={slots:A,slotProps:j},[J,De]=te("root",{elementType:He,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:u,className:G(S.root,R),ref:r}),[Se,Ce]=te("backdrop",{elementType:ze,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:u}),[Oe,je]=te("paper",{elementType:Ye,shouldForwardComponentProp:!0,externalForwardedProps:K,ownerState:u,className:G(S.paper,z.className)}),[ye,Fe]=te("container",{elementType:Ge,externalForwardedProps:K,ownerState:u,className:S.container}),[ke,Le]=te("transition",{elementType:pe,externalForwardedProps:K,ownerState:u,additionalProps:{appear:!0,in:V,timeout:F,role:"presentation"}});return o.jsx(J,{closeAfterTransition:!0,slots:{backdrop:Se},slotProps:{backdrop:{transitionDuration:F,as:g,...Ce}},disableEscapeKeyDown:N,onClose:I,open:V,onClick:C,...De,..._,children:o.jsx(ke,{...Le,children:o.jsx(ye,{onMouseDown:q,...Fe,children:o.jsx(Oe,{as:W,elevation:24,role:"dialog","aria-describedby":l,"aria-labelledby":w,"aria-modal":d,...je,children:o.jsx(we.Provider,{value:Q,children:b})})})})})});function qe(e){return se("MuiDialogActions",e)}re("MuiDialogActions",["root","spacing"]);const Qe=e=>{const{classes:t,disableSpacing:r}=e;return ae({root:["root",!r&&"spacing"]},qe,t)},Je=P("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disableSpacing&&t.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),et=p.forwardRef(function(t,r){const s=ne({props:t,name:"MuiDialogActions"}),{className:n,disableSpacing:a=!1,...l}=s,i={...s,disableSpacing:a},d=Qe(i);return o.jsx(Je,{className:G(d.root,n),ownerState:i,ref:r,...l})});function tt(e){return se("MuiDialogContent",e)}re("MuiDialogContent",["root","dividers"]);function ot(e){return se("MuiDialogTitle",e)}const rt=re("MuiDialogTitle",["root"]),st=e=>{const{classes:t,dividers:r}=e;return ae({root:["root",r&&"dividers"]},tt,t)},nt=P("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.dividers&&t.dividers]}})(ve(({theme:e})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:t})=>t.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(e.vars||e).palette.divider}`,borderBottom:`1px solid ${(e.vars||e).palette.divider}`}},{props:({ownerState:t})=>!t.dividers,style:{[`.${rt.root} + &`]:{paddingTop:0}}}]}))),at=p.forwardRef(function(t,r){const s=ne({props:t,name:"MuiDialogContent"}),{className:n,dividers:a=!1,...l}=s,i={...s,dividers:a},d=st(i);return o.jsx(nt,{className:G(d.root,n),ownerState:i,ref:r,...l})});function it(e){return se("MuiDialogContentText",e)}re("MuiDialogContentText",["root"]);const lt=e=>{const{classes:t}=e,s=ae({root:["root"]},it,t);return{...t,...s}},ct=P(x,{shouldForwardProp:e=>Te(e)||e==="classes",name:"MuiDialogContentText",slot:"Root"})({}),dt=p.forwardRef(function(t,r){const s=ne({props:t,name:"MuiDialogContentText"}),{children:n,className:a,...l}=s,i=lt(l);return o.jsx(ct,{component:"p",variant:"body1",color:"textSecondary",ref:r,ownerState:l,className:G(i.root,a),...s,classes:i})}),ut=e=>{const{classes:t}=e;return ae({root:["root"]},ot,t)},pt=P(x,{name:"MuiDialogTitle",slot:"Root"})({padding:"16px 24px",flex:"0 0 auto"}),ht=p.forwardRef(function(t,r){const s=ne({props:t,name:"MuiDialogTitle"}),{className:n,id:a,...l}=s,i=s,d=ut(i),{titleId:g=a}=p.useContext(we);return o.jsx(pt,{component:"h2",className:G(d.root,n),ownerState:i,ref:r,variant:"h6",id:a??g,...l})}),xe=Y(o.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),ft=Y(o.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l4.65-4.65c.2-.2.51-.2.71 0L17 13z"})),mt=Y(o.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"})),xt=Y(o.jsx("path",{d:"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1"})),gt=Y(o.jsx("path",{d:"m10.8 15.9 4.67-3.5c.27-.2.27-.6 0-.8L10.8 8.1c-.33-.25-.8-.01-.8.4v7c0 .41.47.65.8.4M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),ge=Y(o.jsx("path",{d:"M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3M12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1m1 4h-2v-2h2z"}));var c;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(c||(c={}));const Rt=(()=>{let e=0;return()=>e++})(),Et=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),vt=new Error("called FFmpeg.terminate()");class bt{#t=null;#r={};#o={};#s=[];#n=[];loaded=!1;#a=()=>{this.#t&&(this.#t.onmessage=({data:{id:t,type:r,data:s}})=>{switch(r){case c.LOAD:this.loaded=!0,this.#r[t](s);break;case c.MOUNT:case c.UNMOUNT:case c.EXEC:case c.FFPROBE:case c.WRITE_FILE:case c.READ_FILE:case c.DELETE_FILE:case c.RENAME:case c.CREATE_DIR:case c.LIST_DIR:case c.DELETE_DIR:this.#r[t](s);break;case c.LOG:this.#s.forEach(n=>n(s));break;case c.PROGRESS:this.#n.forEach(n=>n(s));break;case c.ERROR:this.#o[t](s);break}delete this.#r[t],delete this.#o[t]})};#e=({type:t,data:r},s=[],n)=>this.#t?new Promise((a,l)=>{const i=Rt();this.#t&&this.#t.postMessage({id:i,type:t,data:r},s),this.#r[i]=a,this.#o[i]=l,n?.addEventListener("abort",()=>{l(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Et);on(t,r){t==="log"?this.#s.push(r):t==="progress"&&this.#n.push(r)}off(t,r){t==="log"?this.#s=this.#s.filter(s=>s!==r):t==="progress"&&(this.#n=this.#n.filter(s=>s!==r))}load=({classWorkerURL:t,...r}={},{signal:s}={})=>(this.#t||(this.#t=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#a()),this.#e({type:c.LOAD,data:r},void 0,s));exec=(t,r=-1,{signal:s}={})=>this.#e({type:c.EXEC,data:{args:t,timeout:r}},void 0,s);ffprobe=(t,r=-1,{signal:s}={})=>this.#e({type:c.FFPROBE,data:{args:t,timeout:r}},void 0,s);terminate=()=>{const t=Object.keys(this.#o);for(const r of t)this.#o[r](vt),delete this.#o[r],delete this.#r[r];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(t,r,{signal:s}={})=>{const n=[];return r instanceof Uint8Array&&n.push(r.buffer),this.#e({type:c.WRITE_FILE,data:{path:t,data:r}},n,s)};mount=(t,r,s)=>{const n=[];return this.#e({type:c.MOUNT,data:{fsType:t,options:r,mountPoint:s}},n)};unmount=t=>{const r=[];return this.#e({type:c.UNMOUNT,data:{mountPoint:t}},r)};readFile=(t,r="binary",{signal:s}={})=>this.#e({type:c.READ_FILE,data:{path:t,encoding:r}},void 0,s);deleteFile=(t,{signal:r}={})=>this.#e({type:c.DELETE_FILE,data:{path:t}},void 0,r);rename=(t,r,{signal:s}={})=>this.#e({type:c.RENAME,data:{oldPath:t,newPath:r}},void 0,s);createDir=(t,{signal:r}={})=>this.#e({type:c.CREATE_DIR,data:{path:t}},void 0,r);listDir=(t,{signal:r}={})=>this.#e({type:c.LIST_DIR,data:{path:t}},void 0,r);deleteDir=(t,{signal:r}={})=>this.#e({type:c.DELETE_DIR,data:{path:t}},void 0,r)}var le;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(le||(le={}));const wt=new Error("failed to get response body reader"),Dt=new Error("failed to complete download"),St="Content-Length",Ct=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{const{result:n}=s;n instanceof ArrayBuffer?t(new Uint8Array(n)):t(new Uint8Array)},s.onerror=n=>{r(Error(`File could not be read! Code=${n?.target?.error?.code||-1}`))},s.readAsArrayBuffer(e)}),Ot=async e=>{let t;if(typeof e=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else if(e instanceof File||e instanceof Blob)t=await Ct(e);else return new Uint8Array;return new Uint8Array(t)},jt=async(e,t)=>{const r=await fetch(e);let s;try{const n=parseInt(r.headers.get(St)||"-1"),a=r.body?.getReader();if(!a)throw wt;const l=[];let i=0;for(;;){const{done:f,value:b}=await a.read(),R=b?b.length:0;if(f){if(n!=-1&&n!==i)throw Dt;t&&t({url:e,total:n,received:i,delta:R,done:f});break}l.push(b),i+=R,t&&t({url:e,total:n,received:i,delta:R,done:f})}const d=new Uint8Array(i);let g=0;for(const f of l)d.set(f,g),g+=f.length;s=d.buffer}catch(n){console.log("failed to send download progress event: ",n),s=await r.arrayBuffer()}return s},de=async(e,t,r=!1,s)=>{const n=r?await jt(e,s):await(await fetch(e)).arrayBuffer(),a=new Blob([n],{type:t});return URL.createObjectURL(a)};function yt(){try{return typeof File>"u"?(console.warn("[WORKERFS] File API 不支持"),!1):typeof Worker>"u"?(console.warn("[WORKERFS] Web Worker 不支持"),!1):typeof window<"u"&&!window.isSecureContext?(console.warn("[WORKERFS] 非安全上下文（需要 HTTPS 或 localhost）"),!1):(console.log("[WORKERFS] 静态环境检查通过"),!0)}catch(e){return console.error("[WORKERFS] 静态检查失败:",e),!1}}async function Ft(e){const t="/.probe-workerfs";try{await e.createDir(t);const r=new Uint8Array([1,2,3]),s=new Blob([r],{type:"application/octet-stream"}),n=new File([s],"probe.bin",{type:"application/octet-stream"});await e.mount(le.WORKERFS,{files:[n]},t);const a=await e.readFile(`${t}/probe.bin`),l=a&&a.length===r.length;return await e.unmount(t),await e.deleteDir(t),console.log(`[WORKERFS] 动态探测${l?"成功":"失败"}`),l}catch(r){console.warn("[WORKERFS] 动态探测失败:",r);try{await e.unmount(t).catch(()=>{}),await e.deleteDir(t).catch(()=>{})}catch{}return!1}}async function kt(e){try{return yt()?await Ft(e):!1}catch(t){return console.error("[WORKERFS] 支持检测失败:",t),!1}}function Lt(e){const t=e.match(/\.[^/.]+$/);return t?t[0]:""}function It(e){return{mp4:"video/mp4",mov:"video/quicktime",mkv:"video/x-matroska",gif:"image/gif"}[e]||"video/mp4"}function X(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}const At=()=>{const[e,t]=p.useState(!1),[r,s]=p.useState(!1),[n,a]=p.useState(null),[l,i]=p.useState(null),[d,g]=p.useState(null),[f,b]=p.useState(null),[R,N]=p.useState(!1),O=p.useRef(null),B=p.useRef(!1),v=p.useRef(null),$=p.useCallback(async()=>{if(!(B.current&&O.current)){t(!0),i(null);try{const h=E.CDN_PACKAGES.FFMPEG,m=new bt;m.on("log",({message:D})=>{console.log("[FFmpeg]",D)}),m.on("progress",({progress:D,time:_})=>{a({ratio:D,time:_,speed:`${(D*100).toFixed(1)}%`})}),await m.load({coreURL:await de(`${h}/ffmpeg-core.js`,"text/javascript"),wasmURL:await de(`${h}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await de(`${h}/ffmpeg-core.worker.js`,"text/javascript")}),O.current=m,B.current=!0,console.log("FFmpeg 加载成功"),console.log("[WORKERFS] 开始检测支持...");const F=await kt(m);N(F),console.log(F?"[WORKERFS] ✅ 支持！将在处理时优先使用 WORKERFS 模式":"[WORKERFS] ❌ 不支持，将使用 RAM 模式")}catch(h){const m=h instanceof Error?h.message:"加载 FFmpeg 失败";i(m),console.error("加载 FFmpeg 失败:",h)}finally{t(!1)}}},[]),I=p.useCallback(()=>{d?.url&&URL.revokeObjectURL(d.url),g(null)},[d]),V=p.useCallback(async(h,m,F)=>{if(!O.current||!B.current){i("FFmpeg 尚未加载，请先加载");return}const D=new AbortController;v.current=D,s(!0),i(null),a(null),d?.url&&URL.revokeObjectURL(d.url),g(null);const _=R;try{const u=O.current,S="input"+Lt(h.name),k=`output.${m}`;if(_){console.log("[WORKERFS] 使用 WORKERFS 模式处理大文件...");const j="/input",K=`${j}/${h.name}`;try{await u.createDir(j),await u.mount(le.WORKERFS,{files:[h]},j),console.log("开始转换...");const J=Re(K,k,m,F);await u.exec(J,void 0,{signal:D.signal}),await u.unmount(j),await u.deleteDir(j)}catch(J){try{await u.unmount(j).catch(()=>{}),await u.deleteDir(j).catch(()=>{})}catch{}throw J}}else{console.log("[RAM] 使用传统 RAM 模式..."),console.log("写入输入文件..."),await u.writeFile(S,await Ot(h)),console.log("开始转换...");const j=Re(S,k,m,F);await u.exec(j,void 0,{signal:D.signal}),await u.deleteFile(S)}console.log("读取输出文件...");const q=await u.readFile(k),C=new Blob([q],{type:It(m)}),w=URL.createObjectURL(C),A=`${h.name.replace(/\.[^/.]+$/,"")}.${m}`;g({url:w,name:A}),console.log(`转换成功 (使用 ${_?"WORKERFS":"RAM"} 模式)`),await u.deleteFile(k)}catch(u){if(u instanceof DOMException&&u.name==="AbortError")console.log("转换已被用户取消"),i("转换已取消");else{const S=u instanceof Error?u.message:"视频转换失败";i(S),console.error("视频转换失败:",u)}}finally{s(!1),a(null),v.current=null}},[d,R]),W=p.useCallback(()=>{v.current&&r&&(console.log("正在取消转换..."),v.current.abort())},[r]),z=p.useCallback(h=>{const m=URL.createObjectURL(h);return b(m),m},[]),Z=p.useCallback(h=>{URL.revokeObjectURL(h),f===h&&b(null)},[f]),T=p.useCallback(()=>{i(null)},[]);return{isLoading:e,isConverting:r,progress:n,error:l,outputFile:d,previewUrl:f,supportsWorkerFS:R,loadFFmpeg:$,convertVideo:V,cancelConversion:W,clearOutput:I,clearError:T,getPreviewUrl:z,revokePreviewUrl:Z}};function Re(e,t,r,s){const n=["-i",e];let a=[];switch(r){case"mp4":case"mov":a=["-c:v","libx264","-preset","medium","-crf","23","-c:a","aac"];break;case"mkv":a=["-c:v","libx265","-preset","medium","-crf","24","-c:a","aac"];break;case"gif":{const l=s?.fps||E.VIDEO_CONVERTOR.DEFAULT_WIDTH/48,i=s?.width||E.VIDEO_CONVERTOR.DEFAULT_WIDTH;let d=`fps=${Math.min(l,E.VIDEO_CONVERTOR.MAX_FPS)}`;if(d+=`,scale=${Math.min(i,E.VIDEO_CONVERTOR.MAX_WIDTH)}:-1:flags=lanczos`,s?.maxDuration){const f=E.VIDEO_CONVERTOR.MAX_FRAMES/l;a=["-t",Math.min(s.maxDuration,f).toString()]}a=[...a,"-vf",d];break}default:a=["-c:v","copy","-c:a","copy"]}return[...n,...a,t]}const Mt=({config:e,onChange:t,videoDuration:r})=>{const s=(g,f)=>{t({...e,fps:f})},n=(g,f)=>{t({...e,width:f})},a=r?Math.ceil(e.fps*r):null,l=E.VIDEO_CONVERTOR.MAX_FRAMES/e.fps,i=a!==null&&a>E.VIDEO_CONVERTOR.MAX_FRAMES,d=i?l:r;return y.useEffect(()=>{if(i&&d)t({...e,maxDuration:d});else{const{maxDuration:g,...f}=e;g!==void 0&&t(f)}},[i,d]),o.jsx(ue,{variant:"outlined",sx:{mt:2},children:o.jsxs(be,{children:[o.jsx(x,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"GIF 转换设置"}),o.jsxs(M,{spacing:3,children:[o.jsxs(L,{children:[o.jsxs(x,{variant:"body2",gutterBottom:!0,children:["帧率 (FPS): ",e.fps]}),o.jsx(he,{value:e.fps,onChange:s,min:1,max:E.VIDEO_CONVERTOR.MAX_FPS,step:1,marks:[{value:3,label:"3"},{value:10,label:"10"},{value:15,label:"15"},{value:24,label:"24"},{value:30,label:"30"}],valueLabelDisplay:"auto"}),o.jsx(x,{variant:"caption",color:"text.secondary",children:"较低的帧率可以减小文件大小，但动画会不够流畅"})]}),o.jsxs(L,{children:[o.jsxs(x,{variant:"body2",gutterBottom:!0,children:["宽度 (px): ",e.width]}),o.jsx(he,{value:e.width,onChange:n,min:240,max:E.VIDEO_CONVERTOR.MAX_WIDTH,step:40,marks:[{value:360,label:"360"},{value:480,label:"480"},{value:720,label:"720"},{value:1080,label:"1080"},{value:1920,label:"1920"}],valueLabelDisplay:"auto"}),o.jsx(x,{variant:"caption",color:"text.secondary",children:"宽度越小，文件大小越小。高度会按比例自动调整"})]}),a!==null&&o.jsxs(oe,{severity:i?"warning":"info",sx:{mt:1},children:[o.jsxs(x,{variant:"body2",children:["预估帧数: ",a.toLocaleString()," 帧"]}),i&&o.jsxs(o.Fragment,{children:[o.jsxs(x,{variant:"body2",sx:{mt:1},children:["⚠️ 超出最大帧数限制 (",E.VIDEO_CONVERTOR.MAX_FRAMES.toLocaleString()," 帧)"]}),o.jsxs(x,{variant:"body2",sx:{mt:.5},children:["将只转换前 ",l.toFixed(1)," 秒的内容"]})]})]})]})]})})},Wt=()=>{const{isLoading:e,isConverting:t,progress:r,error:s,outputFile:n,loadFFmpeg:a,convertVideo:l,cancelConversion:i,clearOutput:d,clearError:g,getPreviewUrl:f,revokePreviewUrl:b}=At(),[R,N]=y.useState(null),[O,B]=y.useState("mp4"),[v,$]=y.useState(null),[I,V]=y.useState(null),[W,z]=y.useState(E.VIDEO_CONVERTOR.MAX_FILE_SIZE_BYTES),[Z,T]=y.useState(!1),[h,m]=y.useState({fps:10,width:E.VIDEO_CONVERTOR.DEFAULT_WIDTH}),F=y.useRef(null);y.useEffect(()=>{a()},[a]),y.useEffect(()=>()=>{v&&b(v)},[v,b]);const D=C=>{const w=C.target.files?.[0];if(w){if(!w.type.startsWith("video/")&&!w.name.endsWith(".mkv")){alert("请选择视频文件");return}if(w.size>W){alert(`文件大小超过限制 (${X(W)})。
当前文件大小: ${X(w.size)}

您可以在下方解除限制。`);return}N(w),g();const Q=f(w);$(Q);const A=document.createElement("video");A.preload="metadata",A.onloadedmetadata=()=>{V(A.duration),URL.revokeObjectURL(A.src)},A.src=Q}},_=async()=>{if(!R)return;await l(R,O,O==="gif"?h:void 0)},u=()=>{if(!n)return;const C=document.createElement("a");C.href=n.url,C.download=n.name,C.click()},S=()=>{N(null),v&&(b(v),$(null)),V(null),d(),g()},k=()=>{T(!0)},q=()=>{z(E.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED),T(!1)};return o.jsxs(L,{sx:{maxWidth:800,mx:"auto",py:3},children:[o.jsx(ue,{elevation:3,children:o.jsxs(be,{children:[e&&o.jsxs(oe,{severity:"info",sx:{mb:2},children:[o.jsx(x,{variant:"body2",children:"正在加载 FFmpeg..."}),o.jsx(me,{sx:{mt:1}})]}),s&&o.jsx(oe,{severity:"error",sx:{mb:2},action:o.jsx(fe,{color:"inherit",size:"small",onClick:g,children:o.jsx(xe,{fontSize:"small"})}),children:s}),o.jsxs(M,{spacing:3,children:[W<E.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED&&o.jsxs(oe,{severity:"info",sx:{mb:0},children:[o.jsxs(x,{variant:"body2",gutterBottom:!0,children:["当前文件大小限制: ",X(W)]}),o.jsxs(U,{size:"small",variant:"outlined",onClick:k,startIcon:o.jsx(ge,{}),sx:{mt:1},children:["解除限制（最大"," ",X(E.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED),"）"]})]}),o.jsxs(L,{children:[o.jsxs(U,{variant:"contained",component:"label",startIcon:o.jsx(ft,{}),disabled:e||t,fullWidth:!0,children:["选择视频文件",o.jsx("input",{type:"file",accept:"video/*",hidden:!0,onChange:D})]}),R&&o.jsx(ue,{variant:"outlined",sx:{mt:2,p:2},children:o.jsxs(M,{direction:"row",spacing:2,alignItems:"center",children:[o.jsxs(L,{flex:1,children:[o.jsx(x,{variant:"body2",fontWeight:"medium",children:R.name}),o.jsxs(x,{variant:"caption",color:"text.secondary",children:[X(R.size),I&&` • ${I.toFixed(1)}秒`]})]}),o.jsx(fe,{size:"small",onClick:S,disabled:t,children:o.jsx(mt,{})})]})})]}),R&&v&&o.jsxs(L,{children:[o.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"视频预览"}),o.jsx(L,{sx:{position:"relative",width:"100%",maxWidth:640,mx:"auto",bgcolor:"black",borderRadius:1,overflow:"hidden"},children:o.jsx("video",{ref:F,src:v,controls:!0,style:{width:"100%",height:"auto",display:"block"}})})]}),R&&o.jsxs(o.Fragment,{children:[o.jsxs(Be,{fullWidth:!0,children:[o.jsx($e,{id:"output-format-label",children:"输出格式"}),o.jsxs(Ve,{labelId:"output-format-label",value:O,label:"输出格式",onChange:C=>B(C.target.value),disabled:t,children:[o.jsx(ie,{value:"mp4",children:"MP4 (H.264)"}),o.jsx(ie,{value:"mov",children:"MOV (H.264)"}),o.jsx(ie,{value:"mkv",children:"MKV (H.265)"}),o.jsx(ie,{value:"gif",children:"GIF (动图)"})]})]}),O==="gif"&&o.jsx(Mt,{config:h,onChange:m,videoDuration:I||void 0}),t?o.jsx(M,{direction:"row",spacing:2,children:o.jsx(U,{variant:"outlined",color:"error",size:"large",startIcon:o.jsx(xe,{}),onClick:i,fullWidth:!0,children:"取消转换"})}):o.jsx(U,{variant:"contained",color:"primary",size:"large",startIcon:o.jsx(gt,{}),onClick:_,disabled:!R||e||t,fullWidth:!0,children:"开始转换"})]}),t&&r&&o.jsxs(L,{children:[o.jsxs(M,{direction:"row",justifyContent:"space-between",mb:1,children:[o.jsx(x,{variant:"body2",children:"转换进度"}),o.jsx(x,{variant:"body2",fontWeight:"medium",children:r.speed})]}),o.jsx(me,{variant:"determinate",value:r.ratio*100})]}),n&&o.jsxs(o.Fragment,{children:[o.jsx(_e,{}),o.jsxs(oe,{severity:"success",sx:{mb:0},children:[o.jsx(x,{variant:"body2",gutterBottom:!0,children:"转换完成！"}),o.jsx(M,{direction:"row",spacing:1,alignItems:"center",mt:1,children:o.jsx(Ne,{label:n.name,size:"small",color:"success"})})]}),o.jsxs(M,{direction:"row",spacing:2,children:[o.jsx(U,{variant:"contained",color:"success",startIcon:o.jsx(xt,{}),onClick:u,fullWidth:!0,children:"下载转换后的视频"}),o.jsx(U,{variant:"outlined",onClick:S,children:"重新转换"})]})]})]})]})}),o.jsxs(Ze,{open:Z,onClose:()=>T(!1),children:[o.jsx(ht,{children:o.jsxs(M,{direction:"row",spacing:1,alignItems:"center",children:[o.jsx(ge,{color:"warning"}),o.jsx("span",{children:"解除文件大小限制"})]})}),o.jsx(at,{children:o.jsxs(dt,{children:["您即将解除文件大小限制，最大可处理"," ",X(E.VIDEO_CONVERTOR.MAX_SIZE_UNLOCKED)," 的文件。",o.jsx("br",{}),o.jsx("br",{}),"• 处理大文件将会消耗大量内存和时间",o.jsx("br",{}),"• 可能导致浏览器卡顿或崩溃",o.jsx("br",{}),"• 请确认设备硬件配置较好",o.jsx("br",{}),o.jsx("br",{}),"确定要继续吗？"]})}),o.jsxs(et,{children:[o.jsx(U,{onClick:()=>T(!1),children:"取消"}),o.jsx(U,{onClick:q,color:"warning",variant:"contained",children:"确认解除限制"})]})]})]})},Nt=()=>{let e="视频格式转换器",t="在浏览器中转换视频格式，支持多种格式互转。";for(const r of Ue)r.link==="/videoconvertor"&&(e=r.title,t=r.description);return o.jsx(Pe,{children:o.jsx(L,{sx:{py:6},children:o.jsxs(M,{spacing:4,alignItems:"center",children:[o.jsxs(L,{textAlign:"center",children:[o.jsx(x,{variant:"h3",gutterBottom:!0,children:e}),o.jsx(x,{variant:"h6",color:"text.secondary",children:t})]}),o.jsx(Wt,{})]})})})};export{Nt as default};
